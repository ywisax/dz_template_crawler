<?php@set_time_limit(0);$global_time_start = microtime(true);//ob_start(); //打开输出缓冲区 ob_end_flush(); ob_implicit_flush(1); //立即输出echo str_repeat(" ",4096); //确保足够的字符，立即输出，Linux服务器可以去掉这个语句$target = isset($_GET['target']) ? $_GET['target'] : FALSE;if ( ! $target){	exit('Usage: dz_template.php?target=http://site/template/default');}function mkpath($mkpath,$mode=0777){	$path_arr=explode('/',$mkpath);	foreach ($path_arr as $value){		if(!empty($value)){			if(empty($path))			{				$path=$value;			}			else			{				$path.='/'.$value;			}			is_dir($path) or mkdir($path,$mode);		}	}     if(is_dir($mkpath))return true;     return false;}$dir = md5($target);$files = file('dz_template.txt');foreach ($files AS $file){	$file = trim($file);	$url = $target . $file;	if ($content = @file_get_contents($url))	{		mkpath(dirname($dir.$file));		file_put_contents($dir.$file, $content);		echo 'Get '.$url.'<br />';		preg_match_all('@<!--{subtemplate (.*)}-->@', $content, $matches);		if ( ! empty($matches[1]))		{			foreach ($matches[1] AS $check_file)			{				$check_file = str_replace('\\', '/', $check_file);				$check_file = '/'.$check_file.'.htm';				if ( ! in_array($check_file, $files))				{					$files[] = $check_file;				}			}		}	}}